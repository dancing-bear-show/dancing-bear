#!/usr/bin/env bash
set -euo pipefail
cd "$(dirname "$0")/.."

PYTHON_BIN="${PYTHON:-python3.11}"
if ! command -v "$PYTHON_BIN" >/dev/null 2>&1; then
  PYTHON_BIN="${PYTHON:-python3}"
fi
if ! command -v "$PYTHON_BIN" >/dev/null 2>&1; then
  echo "python3.11 or python3 not found; install Homebrew python@3.11 or set PYTHON=<path>" >&2
  exit 1
fi

if [ ! -d .venv ]; then
  "$PYTHON_BIN" -m venv .venv
fi
./.venv/bin/python -m pip install -U pip
./.venv/bin/python -m pip install -e .

# Make wrapper executable for direct invocation
chmod +x bin/mail || true

echo "Virtual env ready: .venv"
echo "Console script available after install: mail-assistant"
echo "Run: .venv/bin/python -m unittest -v"
